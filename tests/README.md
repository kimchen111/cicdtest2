# 高可用性问题
## 一、主机主备
### AB机，负责机器的可用性问题

## 二、链路主备
### 红绿线，负责到VPE1/VPE3的链路问题

## 三、公网主备
### 负责运营商A和运营商B的可用问题
### 如果有三存在，则一定需AB机都同时接两个公网

## 影响关系
### 机器-》链路
### 公网-》链路


## 连接机制

主备机均同时连接到服务器端（VPE），每一条链路的两端都产生一个独立的虚拟网卡，相互之间不复用，也就是说，服务器端也是不复用 ，这样就可以规避掉allowed-ips问题。  
因此，全面配置的状况下会产生4条VPN链路   

### CPE1 - A组
A1 CPE1-VPE1  
A2 CPE1-VPE2

### CPE2 - B组
B1 CPE2-VPE1  
B2 CPE2-VPE2   

***
## 调度策略

### 主备机及主备链路使用优先级来控制

X1优先级高，X2优先级低
LOCAL preferenc
MED
通过两个BGP链路的属性来调整
一个控制进，一个控制出

## 什么时候需要自动调整优先级呢？

根据监控数据优劣情况，进行调整

## keepalived关联的资源
1、LAN上的VIP  
2、BGP路由的发布  
