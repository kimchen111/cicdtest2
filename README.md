# 控制器说明
##

## 概要

本服务提供犀思云SDWAN系统的控制器API服务，接受CPE、VPE的注册，接受中心管理控制台的API调用，从技术上来讲类似于是集合了API网关、业务中间件、frps的功能

## 架构图
![架构图] (/img/arch.png)

从技术上来讲分为两个部分

### 一、 是API服务部分
API提代给中心管理控制台的API调用

这一部分通过gin来实现

同时使用gin-swagger来实现API的文档自动化。

### 二、 设备注册管理部分
接受CPE、HUB、VPE的注册（连接），把业务端的API调用转换成RPC（通过异步消息来实现），调用sdwan-device的agent服务。

这一部分使用ZeroMQ的Router-Dealer来实现，控制器端作为Router角色。

一个设备注册到控制器上来，自然带携带一个ID标识符，这个ID标识符是使用的设备ESN。

当API调用或者控制器的定时任务需要让某个设备做某个工作的时候，就可以发生相应的消息来通知对方执行任务。


# 控制器需要并行的工作

## 1、 从AGENT接收消息（任务、结果）
## 2、 往AGENT发送消息（结果、任务）
## 3、 本地定时工作
## 4、 GIN API

# CPE说明
##

所有传输的都称为消息，“消息” 可以是任务，也可以是结果，也可以是心跳

使用ZeroMQ的各种机制只是为了简化网络传输模型

# 实现层面需要并行的工作（使用goroutine实现）

## 1、 从控制器接收消息（任务、结果）
## 2、 执行任务
## 3、 往控制器发送消息（结果、任务）
## 4、 本地定时工作
## 5、 GIN


